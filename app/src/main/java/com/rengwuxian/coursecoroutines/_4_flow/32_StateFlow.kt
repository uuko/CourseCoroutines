package com.rengwuxian.coursecoroutines._4_flow

import kotlinx.coroutines.CoroutineScope
import kotlinx.coroutines.Dispatchers
import kotlinx.coroutines.cancel
import kotlinx.coroutines.delay
import kotlinx.coroutines.flow.MutableSharedFlow
import kotlinx.coroutines.flow.MutableStateFlow
import kotlinx.coroutines.flow.asStateFlow
import kotlinx.coroutines.flow.collect
import kotlinx.coroutines.flow.flow
import kotlinx.coroutines.flow.stateIn
import kotlinx.coroutines.launch
import kotlinx.coroutines.runBlocking
import kotlin.coroutines.EmptyCoroutineContext
import kotlin.random.Random

fun main() = runBlocking<Unit> {
  val scope = CoroutineScope(EmptyCoroutineContext)
//  val name = MutableStateFlow("rengwuxian")
//  val flow1 = flow {
//    emit(1)
//    delay(1000)
//    emit(2)
//    delay(1000)
//    emit(3)
//  }
//  name.asStateFlow()
//  val state = flow1.stateIn(scope)
//  scope.launch {
//    name.collect {
//      println("State: $it")
//    }
//  }
//  scope.launch {
//    delay(2000)
//    name.emit("æ‰”ç‰©çº¿")
//  }

  //å¦‚æœæ”¹æˆshareflowË‹ç›´æ¥æ”¶é›†å°±ä¸å¥½äº† æœƒè·Ÿè‘—ä¸€èµ·åœå°å§
  //ChatGPT èªªï¼š
  //ChatGPT
  //æ²’éŒ¯ï¼å¦‚æœä½ ç›´æ¥åœ¨ç›¸åŒçš„å”ç¨‹ç¯„åœ (scope) ä¸­å•Ÿå‹• SharedFlow å’Œæ”¶é›†å®ƒï¼Œç•¶ scope.cancel() è¢«èª¿ç”¨æ™‚ï¼Œä¸Šæ¸¸å’Œä¸‹æ¸¸éƒ½æœƒä¸€èµ·åœæ­¢ã€‚
  //âœ… æ­£ç¢ºæ–¹å¼ â€“ åˆ†é›¢ä¸Šä¸‹æ¸¸å”ç¨‹ç¯„åœ æˆ–æ˜¯ç”¨flow+shareflow
  //è¦è®“ SharedFlow çš„æ•¸æ“šæŒçºŒç™¼é€ï¼Œå³ä½¿ä¸‹æ¸¸åœæ­¢æ”¶é›†ï¼Œä¸Šæ¸¸ä»èƒ½ä¿æŒæ•¸æ“šç”Ÿç”¢ï¼Œå¯ä»¥é€™æ¨£åšï¼š
  //
  //ğŸ”¹ é—œéµé»ï¼š
  //ä¸Šæ¸¸æ•¸æ“šç”Ÿç”¢å’Œä¸‹æ¸¸æ”¶é›†åˆ†é›¢ï¼Œåˆ†åˆ¥é‹è¡Œåœ¨ä¸åŒçš„ CoroutineScope ä¸­ã€‚
  //å³ä½¿ä¸‹æ¸¸çš„ collect åœæ­¢ï¼Œä¸Šæ¸¸æ•¸æ“šç”Ÿç”¢å”ç¨‹ä¾ç„¶ç¨ç«‹å­˜åœ¨ã€‚

  val stockPriceFlow = MutableSharedFlow<Float>(
    replay = 3,                    // ç·©å­˜æœ€è¿‘ 3 æ¢æ•¸æ“š
    extraBufferCapacity = 5
  )

// ä¸Šæ¸¸ï¼šè² è²¬æŒçºŒç™¼é€æ•¸æ“š
  val producerScope = CoroutineScope(Dispatchers.Default)
  producerScope.launch {
    while (true) {
      val price = 100 + Random.nextFloat() * 10
      stockPriceFlow.emit(price)
      println("ğŸ“¤ ç™¼é€æ–°è‚¡åƒ¹: $price")
      delay(1000)
    }
  }

// ä¸‹æ¸¸ï¼šç•¶ç”¨æˆ¶é€²å…¥é é¢æ™‚æ”¶é›†æ•¸æ“š
  val consumerScope = CoroutineScope(Dispatchers.IO)
  consumerScope.launch {
    println("ğŸ“± é–‹å§‹æ”¶é›†æ•¸æ“š...")
    stockPriceFlow.collect {
      println("ğŸ“ˆ ç•«é¢é¡¯ç¤ºè‚¡åƒ¹: $it")
    }
  }

// æ¨¡æ“¬ 5 ç§’å¾Œç”¨æˆ¶é›¢é–‹é é¢ï¼Œåœæ­¢æ”¶é›†
  consumerScope.launch {
    delay(5000)
    println("ğŸ“´ é›¢é–‹é é¢ï¼Œåœæ­¢æ”¶é›†...")
    consumerScope.cancel()  // åªå–æ¶ˆä¸‹æ¸¸ï¼Œä¸å½±éŸ¿ä¸Šæ¸¸
  }
  //========================
//  val stockPriceFlow = MutableSharedFlow<Float>(
//    replay = 3,
//    extraBufferCapacity = 5
//  )
//
//// ä¸Šæ¸¸æŒçºŒç™¼é€æ•¸æ“š
//  val producerScope = CoroutineScope(Dispatchers.Default)  // ä¸Šæ¸¸ scope
//  producerScope.launch {
//    while (true) {
//      val price = 100 + Random.nextFloat() * 10
//      stockPriceFlow.emit(price)
//      println("ğŸ“¤ ç”¢ç”Ÿæ–°è‚¡åƒ¹: $price")
//      delay(1000)  // æ¨¡æ“¬æ¯ç§’æ›´æ–°ä¸€æ¬¡æ•¸æ“š
//    }
//  }
//
//// ç”¨æˆ¶é€²å…¥é é¢é–‹å§‹æ”¶é›†æ•¸æ“š
//  val consumerScope = CoroutineScope(Dispatchers.IO)  // ä¸‹æ¸¸ scope
//  consumerScope.launch {
//    delay(1000)
//    println("ğŸ“± é–‹å§‹æ”¶é›†æ•¸æ“š...")
//    stockPriceFlow.collect {
//      println("ğŸ“ˆ ç•«é¢é¡¯ç¤ºè‚¡åƒ¹: $it")
//    }
//  }
//
//// æ¨¡æ“¬ 5 ç§’å¾Œç”¨æˆ¶é›¢é–‹é é¢ï¼Œå–æ¶ˆæ¶ˆè²»è€…æ”¶é›†
//  consumerScope.launch {
//    delay(8000)
//    println("ğŸ“´ é›¢é–‹é é¢ï¼Œåœæ­¢æ”¶é›†...")
//    consumerScope.cancel()  // å–æ¶ˆä¸‹æ¸¸æ”¶é›†ï¼Œä¸å½±éŸ¿ä¸Šæ¸¸æ•¸æ“šç™¼é€
//  }
  delay(10000)
}

//@OptIn(ExperimentalSubclassOptIn::class)
//@SubclassOptInRequired(ExperimentalForInheritanceCoroutinesApi::class)
//public interface StateFlow<out T> : SharedFlow<T> {
//    /**
//     * The current value of this state flow.
//     */
//    public val value: T
//}
//stateflow æ˜¯sharedflowæœ€å¾Œä¸€æ¢æœ€æ–°æ•¸æ“š ä¸€å€‹åªèƒ½ç·©å­˜æœ€å¾Œä¸€æ¢æ•¸æ“šçš„shareflow ä¸¦ä¸”èƒ½æ‹¿åˆ°æœ€æ–°ç·©å­˜ ï¼å¸¶æœ‰æœ€æ–°äº‹ä»¶çš„ç‹€æ…‹
//replay 1 val stateflow = MutableSharedFlow<Int>(replay = 1, extraBufferCapacity = 0)
//åªä¿ç•™æœ€æ–°çš„æ•¸æ“šç‹€æ…‹ï¼Œéå»çš„æ•¸æ“šä¸æœƒç·©å­˜æˆ–é‡æ’­ã€‚
//æ–°çš„ collect åªæœƒæ”¶åˆ°ç•¶å‰çš„ç‹€æ…‹ï¼Œä¸æœƒæ”¶åˆ°ä¹‹å‰çš„æ•¸æ“šã€‚
//ç¸½æ˜¯æœ‰åˆå§‹å€¼ï¼Œå› æ­¤èˆ‡ç‹€æ…‹ç®¡ç†éå¸¸å¥‘åˆã€‚
//ç†±æµï¼ˆHot Flowï¼‰ï¼šå³ä½¿æ²’æœ‰æ¶ˆè²»è€…ï¼Œæ•¸æ“šä¹ŸæœƒæŒçºŒæ›´æ–°ã€‚
//æœ€æ–°ç‹€æ…‹æŒçºŒä¿ç•™ï¼š StateFlow å§‹çµ‚ä¿å­˜æœ€æ–°çš„ä¸€æ¢æ•¸æ“šï¼Œéå¸¸é©åˆç”¨æ–¼ UI ç‹€æ…‹ç®¡ç†ã€‚
//è‡ªå‹•é‡ç™¼æœ€æ–°æ•¸æ“šï¼š ç•¶æ¶ˆè²»è€…ï¼ˆUIï¼‰å•Ÿå‹•æ™‚ï¼Œè‡ªå‹•æ¥æ”¶ç•¶å‰æœ€æ–°ç‹€æ…‹ï¼Œç„¡éœ€è™•ç†æ­·å²æ•¸æ“šã€‚
//ç„¡æ•¸æ“šä¸Ÿå¤±é¢¨éšªï¼š å³ä½¿æ¶ˆè²»è€…é€²ç¨‹æ›èµ·æˆ–æ¢å¾©ï¼Œä¹Ÿèƒ½æ‹¿åˆ°æœ€æ–°çš„ç‹€æ…‹ï¼Œé¿å…æ•¸æ“šåŒæ­¥å•é¡Œ

//ç·©è¡çš„é‹ä½œæ–¹å¼
//ç„¡ç·©è¡æ™‚ï¼ˆextraBufferCapacity = 0ï¼‰ï¼š
//
//å¦‚æœä¸‹æ¸¸é‚„åœ¨è™•ç†æ•¸æ“šï¼Œä¸Šæ¸¸ç™¼é€æ–°æ•¸æ“šæ™‚æœƒç›´æ¥æ›èµ·ï¼ˆsuspendï¼‰ï¼Œç›´åˆ°ä¸‹æ¸¸æ¶ˆè²»å®Œç•¢ã€‚
//æˆ–è€…ï¼Œå¦‚æœä½¿ç”¨ tryEmit ç™¼é€ï¼Œå‰‡æœƒç«‹å³è¿”å› falseï¼Œè¡¨ç¤ºæ•¸æ“šç„¡æ³•é€²å…¥ç·©è¡å€ã€‚
//æœ‰ç·©è¡æ™‚ï¼ˆextraBufferCapacity > 0ï¼‰ï¼š
//
//ä¸Šæ¸¸ç™¼é€æ•¸æ“šå¾Œï¼Œå³ä½¿ä¸‹æ¸¸å°šæœªè™•ç†å®Œæˆï¼Œæ•¸æ“šæœƒå…ˆæš«å­˜åˆ°ç·©è¡å€ä¸­ï¼Œä¸Šæ¸¸ä¸æœƒè¢«æ›èµ·ã€‚
//ç·©è¡å€æ»¿äº†ä¹‹å¾Œï¼Œæ–°çš„ç™¼é€æœƒæ›èµ·ï¼Œç›´åˆ°ä¸‹æ¸¸æ¶ˆè²»æ•¸æ“šé‡‹æ”¾ç©ºé–“ã€‚

//æ‰€ä»¥sharflowæ˜¯å¯ä»¥ç”Ÿç”¢è·Ÿæ¶ˆè²»åˆ†é–‹ stateflow ä¸è¡Œï¼Ÿ å› ç‚ºå³ä½¿åº•å±¤æ˜¯shareflowä½†å¥¹ç”±æ–¼ buffer=0 æ‰€ä»¥ä¸€å®šè¦ æ¶ˆè²»å¾Œæ‰èƒ½å†ç”Ÿç”¢ ä½†æ˜¯è·Ÿflowé‚„æ˜¯æœ‰æœ¬è³ªå·®åˆ¥å› ç‚ºä»–ä¸éœ€è¦ï½ƒï½ï½Œï½Œï½…ï½ƒï½”å•Ÿå‹•


//SharedFlowï¼š
//
//ç”Ÿç”¢èˆ‡æ¶ˆè²»å¯ä»¥åˆ†é–‹ï¼Œå³ä½¿æ²’æœ‰æ¶ˆè²»è€…ï¼Œæ•¸æ“šä¾ç„¶å¯ä»¥æŒçºŒç™¼é€ï¼ˆå› ç‚ºæœ‰ç·©è¡å€ extraBufferCapacityï¼‰ã€‚
//å³ä½¿ä¸‹æ¸¸æ…¢ï¼Œä¸Šæ¸¸å¯ä»¥ç¹¼çºŒç™¼é€ï¼Œç·©è¡å€æ»¿å¾Œæ‰æœƒæ›èµ·ã€‚
//äº‹ä»¶æµã€å»£æ’­æµçš„æœ€ä½³é¸æ“‡ã€‚
//StateFlowï¼šå…¶å¯¦é‚„æ˜¯åˆ†é–‹çš„ å› ç‚ºç”Ÿç”¢è€…ä¸éœ€æ¶ˆè²»è€…å•Ÿå‹•
//ä½†æœ¬è³ªä¸Šéƒ½ä¸æœƒè‡ªå‹•çµæŸæˆ–åœæ­¢ï¼Œé™¤éæ‰‹å‹•å–æ¶ˆæˆ–ç¨‹å¼ç¯„åœï¼ˆCoroutineScopeï¼‰çµæŸ
//åªæ˜¯ç”Ÿç”¢è€…åœ¨æ²’æœ‰æ¶ˆè²»è€…æ”¶é›†æ™‚ï¼Œåªèƒ½è¦†è“‹ç•¶å‰ç‹€æ…‹ï¼Œä¸èƒ½ç©ç´¯æˆ–ç·©å­˜æ•¸æ“šã€‚
//ä¸Šæ¸¸æ•¸æ“šç„¡æ³•å †ç©ï¼ŒèˆŠæ•¸æ“šæœƒç›´æ¥ä¸Ÿæ£„ï¼Œç·©è¡ç‚º 0ã€‚
//é©åˆç”¨æ–¼ã€Œæœ€æ–°ç‹€æ…‹æŒçºŒä¿ç•™ã€çš„å ´æ™¯ï¼ˆå¦‚ UI ç‹€æ…‹ç®¡ç†ï¼‰ã€‚


//1. Flow
//
//ç”Ÿç”¢è€…å’Œæ¶ˆè²»è€…åŒæ­¥é‹ä½œï¼Œæ¶ˆè²»è€… collect å•Ÿå‹•å¾Œï¼Œä¸Šæ¸¸æ‰é–‹å§‹ç™¼é€æ•¸æ“šã€‚
//ä½¿ç”¨å ´æ™¯ï¼š é©åˆçŸ­æš«çš„ã€ä¸€å°ä¸€çš„æ•¸æ“šæµè™•ç†ï¼Œç„¡éœ€è·¨å”ç¨‹æˆ–æŒçºŒä¿ç•™æ•¸æ“šçš„å ´æ™¯ã€‚
//ä¾‹å­ï¼š
//ä¸‹è¼‰æ–‡ä»¶é€²åº¦ç›£è½ã€‚
//è«‹æ±‚ä¸€æ¬¡ API ä¸¦è™•ç†çµæœã€‚
//è¡¨å–®é©—è­‰ï¼Œæ¯æ¬¡è¼¸å…¥è§¸ç™¼é©—è­‰æµã€‚
//2. SharedFlow
//
//ç”Ÿç”¢è€…å’Œæ¶ˆè²»è€…å®Œå…¨åˆ†é›¢ï¼Œç”Ÿç”¢è€…å¯ä»¥åœ¨ç„¡æ¶ˆè²»è€…çš„æƒ…æ³ä¸‹æŒçºŒç™¼é€æ•¸æ“šã€‚
//åº•å±¤ï¼š åŸºæ–¼ Channelï¼Œæ”¯æŒè·¨å”ç¨‹ã€‚
//ç·©è¡å€ï¼š å¯é…ç½® extraBufferCapacityï¼ˆé˜²æ­¢æ•¸æ“šä¸Ÿå¤±ï¼‰ã€‚
//å¤šæ’­èƒ½åŠ›ï¼š å¤šå€‹æ¶ˆè²»è€…å¯ä»¥åŒæ™‚æ”¶é›†ï¼Œæ•¸æ“šå»£æ’­ã€‚
//ä½¿ç”¨å ´æ™¯ï¼š é©åˆéœ€è¦äº‹ä»¶æµã€æ•¸æ“šæŒçºŒç”¢ç”Ÿçš„å ´æ™¯ï¼Œå³ä½¿æš«æ™‚ç„¡æ¶ˆè²»è€…ä¹Ÿéœ€æŒçºŒç™¼é€æ•¸æ“šã€‚
//ä¾‹å­ï¼š
//è‚¡ç¥¨å³æ™‚è¡Œæƒ…æ¨é€ã€‚
//å³æ™‚è¨Šæ¯æ¨é€ï¼ˆèŠå¤©å®¤è¨Šæ¯ï¼‰ã€‚
//æ—¥èªŒç›£è½ç³»çµ±ã€‚
//3. StateFlow
//
//StateFlow æœ¬è³ªä¸Šæ˜¯ SharedFlow çš„ç‰¹ä¾‹ï¼Œç·©è¡å›ºå®šç‚º 0ï¼Œé‡æ’­ï¼ˆreplayï¼‰ç‚º 1ã€‚
//ç”Ÿç”¢è€…å’Œæ¶ˆè²»è€…åˆ†é›¢ï¼Œä½†åªä¿ç•™æœ€æ–°ç‹€æ…‹ï¼Œéå»çš„ç‹€æ…‹æœƒè¢«è¦†è“‹ã€‚
//é©ç”¨æ–¼ã€Œç‹€æ…‹ç®¡ç†ã€ï¼Œè€Œéäº‹ä»¶æµã€‚
//ä½¿ç”¨å ´æ™¯ï¼š é©åˆ UI å±¤çš„ç‹€æ…‹ç›£è½æˆ–å–®ç´”çš„ç‹€æ…‹æŒçºŒç›£æ¸¬ã€‚
//ä¾‹å­ï¼š
//ViewModel ä¸­çš„ UI ç‹€æ…‹ç®¡ç†ï¼ˆLoading ç‹€æ…‹ã€æŒ‰éˆ•å•Ÿç”¨ç‹€æ…‹ï¼‰ã€‚
//ç¶²è·¯é€£æ¥ç‹€æ…‹ï¼ˆonline/offline åˆ‡æ›ï¼‰ã€‚
//æ’­æ”¾å™¨æ’­æ”¾ç‹€æ…‹ï¼ˆPlayingã€Pausedã€Stoppedï¼‰ã€‚

//é‚£æˆ‘å€‘ä¾†è¨è«–ä½¿ç”¨å ´æ™¯
//åˆ†æˆflow
//
//sharedflow :  åˆå¾€ä¸‹åˆ†stateflow è·Ÿshareflow
//
//
//é¦–å…ˆ ç”Ÿç”¢è·Ÿæ¶ˆè²»è€…å¯ä»¥åˆ†é–‹çš„ç”¨sharfow å› ç‚ºåº•å±¤æ˜¯ç”¨channelæ‰€ä»¥å¯ä»¥è¼•æ˜“è·¨æ”œç¨‹ flowåªèƒ½ç”¨flowonå»åšåˆ°
//
//ç”Ÿç”¢è€…è·Ÿæ¶ˆè²»è€…å¯ä»¥åˆ†é–‹æ˜¯å› ç‚º ç”¨channelå»åˆ‡å‰² æ‰€ä»¥ä¸ç”¨ä¸€å®šè¦collectå¾Œæ‰å»åš
//
//è€Œæ˜¯ä¸€é–‹å§‹å‰µå»ºå°±æœ‰å¯èƒ½è¨‚é–±ä¸Šæ¸¸
//
//ä½¿ç”¨å ´æ™¯æ˜¯å¯åˆ†é–‹çš„å ´æ™¯ï¼šex:è‚¡ç¥¨æ•¸æ“šæµ åœ¨æœªæœ‰æ¶ˆè²»è€…ä¹Ÿè¦ä¸€ç›´å‚³é
//
//
//ï½†ï½Œï½ï½—æ˜¯è¦å–®ç´”collectå¾Œæ‰åšçš„äº‹æƒ… ï¼ˆæ²’æƒ³åˆ°èˆ‰ä¾‹
//
//
//å†ä¾†æ˜¯ shareflowè·Ÿstateflow
//
//stateflow = buffer0 replay1
//è·Ÿshareflowä¸€æ¨£å¯èƒ½æœƒæ‰æ•¸æ“š ä½†æ²’bufferæ°¸é æ˜¯æœ€æ–°æ•¸æ“š æœƒé‡æ’­æœ€æ–°æ•¸æ“š ç•¶æ¯æ¬¡collecyæ™‚
//
//è·Ÿshareflowä¸€æ¨£å¯ä»¥å»£æ’­ï¼ˆå› ç‚ºshareflowå…¶å¯¦åªæ˜¯æ”¶é›†å·¥å…·æ”¶é›†ä¸Šå±¤flowç™¼çµ¦ä¸‹æ¸¸ï¼‰ ä¸åƒç´”flowæ˜¯collecyæ‰é–‹å§‹
//
//ç”±æ–¼åªæœƒæ‹¿åˆ°æœ€æ–°æ•¸æ“šæ‰€ä»¥é©åˆå»æŸ¥çœ‹ç‹€æ…‹ ä¸é©åˆæŸ¥çœ‹æ•¸æ“š


//ç‰¹æ€§	Flow	SharedFlow	StateFlow
//ç”Ÿç”¢è€…èˆ‡æ¶ˆè²»è€…é—œä¿‚	ç”Ÿç”¢è€…èˆ‡æ¶ˆè²»è€…åŒæ­¥å•Ÿå‹•ï¼Œæ¶ˆè²»è€…å•Ÿå‹•å¾Œç”Ÿç”¢æ•¸æ“š	ç”Ÿç”¢è€…ç¨ç«‹æ–¼æ¶ˆè²»è€…ï¼Œå¯ç„¡æ¶ˆè²»è€…æŒçºŒç™¼é€æ•¸æ“š	ç”Ÿç”¢è€…ç¨ç«‹æ–¼æ¶ˆè²»è€…ï¼Œä¿ç•™æœ€æ–°ç‹€æ…‹
//ç·©è¡å€	ç„¡ç·©è¡å€ï¼Œé€æ¢ç™¼é€	å¯è¨­ç½® extraBufferCapacity	ç·©è¡å€å›ºå®šç‚º 0
//Replay	ç„¡é‡æ’­ï¼Œæ¯æ¬¡ collect é–‹å§‹é‡æ–°ç”Ÿç”¢	å¯é…ç½® replayï¼ˆé‡æ’­å¤šæ¢æ•¸æ“šï¼‰	replay = 1ï¼Œé‡æ’­æœ€æ–°æ•¸æ“š
//æ¶ˆè²»è€…åŠ å…¥å¾Œè¡Œç‚º	åªèƒ½æ”¶é›†æ–°æ•¸æ“š	æ”¶åˆ°ç·©è¡å€æ•¸æ“šæˆ– replay æ•¸æ“š	åªæ”¶åˆ°æœ€æ–°ç‹€æ…‹
//æ¶ˆè²»è€…æ•¸é‡	ä¸€å°ä¸€ï¼ˆå†·æµï¼‰	ä¸€å°å¤šï¼ˆç†±æµï¼‰	ä¸€å°å¤šï¼ˆç†±æµï¼‰
//çµæŸæ¢ä»¶	ä¸Šæ¸¸å®Œæˆæˆ–ç¯„åœçµæŸ	æŒçºŒé‹è¡Œï¼Œç›´åˆ° CoroutineScope è¢«å–æ¶ˆ	æŒçºŒé‹è¡Œï¼Œç›´åˆ° CoroutineScope è¢«å–æ¶ˆ
//é©ç”¨å ´æ™¯	çŸ­æš«æ•¸æ“šæµã€ä¸€æ¬¡æ€§ä»»å‹™	äº‹ä»¶æµã€å¤šæ¶ˆè²»è€…è¨‚é–±æ•¸æ“š	ç‹€æ…‹ç®¡ç†

//ç”Ÿç”¢å’Œæ¶ˆè²»æ˜¯å¦èƒ½ã€Œåˆ†é›¢ã€ æ˜¯æ±ºå®šä½¿ç”¨ Flow æˆ– SharedFlow / StateFlow çš„æ ¸å¿ƒé—œéµã€‚
//æ˜¯å¦éœ€è¦ã€Œç´¯ç©æ­·å²æ•¸æ“šã€æˆ–ã€Œåªé—œå¿ƒæœ€æ–°ç‹€æ…‹ã€ æ˜¯æ±ºå®šä½¿ç”¨ SharedFlow æˆ– StateFlow çš„é—œéµã€‚

//1. ä¸‹è¼‰æ–‡ä»¶é€²åº¦ç›£è½
//ç‰¹æ€§ï¼š ä¸‹è¼‰é–‹å§‹å¾Œï¼Œæ¶ˆè²»è€…åŒæ­¥ç›£è½é€²åº¦è®ŠåŒ–ã€‚
//ç”Ÿç”¢èˆ‡æ¶ˆè²»åŒæ­¥ï¼šæŒ‰ä¸‹æŒ‰éˆ•å¾Œæ‰è§¸ç™¼ä¸‹è¼‰ï¼Œä¸”æ¶ˆè²»ç«¯ï¼ˆé€²åº¦æ¢ï¼‰å¿…é ˆéš¨è‘—æ•¸æ“šæµå‹•ã€‚
//ä½¿ç”¨ï¼šFlow
//ç‚ºä»€éº¼ï¼Ÿ
//æŒ‰ä¸‹æŒ‰éˆ•é–‹å§‹ä¸‹è¼‰ï¼Œcollect å¾Œä¸Šæ¸¸æ‰é–‹å§‹ç”¢ç”Ÿæ•¸æ“šã€‚
//ä¸éœ€è¦ä¿ç•™éå»æ•¸æ“šï¼Œç›´æ¥åŒæ­¥è™•ç†ç•¶å‰é€²åº¦å³å¯ã€‚
//. ä¸‹è¼‰æ–‡ä»¶æ˜¯å¦å®Œæˆï¼ˆåªé—œå¿ƒæœ€æ–°ç‹€æ…‹ï¼‰
//ç‰¹æ€§ï¼š ç„¡è«–ä»€éº¼æ™‚å€™åŠ å…¥æ¶ˆè²»ï¼Œåªé—œå¿ƒæ–‡ä»¶æ˜¯å¦å·²å®Œæˆã€‚
//ç”Ÿç”¢èˆ‡æ¶ˆè²»åˆ†é›¢ï¼šä¸‹è¼‰é€²è¡Œä¸­æˆ–å®Œæˆç‹€æ…‹å¯ä»¥æŒçºŒæ›´æ–°ï¼Œå³ä½¿æ¶ˆè²»è€…æ™šåŠ å…¥ä¹Ÿåªéœ€çŸ¥é“ã€Œæœ€æ–°ç‹€æ…‹ã€ã€‚
//ä½¿ç”¨ï¼šStateFlow
//ç‚ºä»€éº¼ï¼Ÿ
//åªé—œå¿ƒã€Œæœ€æ–°çš„ä¸‹è¼‰ç‹€æ…‹ã€ï¼Œä¾‹å¦‚ï¼šä¸‹è¼‰ä¸­ -> å®Œæˆ -> å¤±æ•—ï¼Œç„¡éœ€ä¿ç•™éå»æ­·ç¨‹ã€‚
//å³ä½¿æ¶ˆè²»è€…æ™šåŠ å…¥ï¼Œä¹Ÿèƒ½ç›´æ¥ç²å¾—ç•¶å‰æœ€æ–°ç‹€æ…‹ï¼ˆStateFlow åªä¿ç•™æœ€æ–°ç‹€æ…‹ï¼‰ã€‚
//. ä¸‹è¼‰æ–‡ä»¶é€²åº¦ï¼ˆå¯ä¿ç•™æ­·å²æ•¸æ“šï¼‰
//ç‰¹æ€§ï¼š é€²åº¦å¯ä»¥ä¿ç•™ä¸€æ®µæ™‚é–“ï¼Œå³ä½¿æ¶ˆè²»è€…æ™šåŠ å…¥ä¹Ÿèƒ½ç²å¾—æœ€è¿‘é€²åº¦è³‡è¨Šã€‚
//ç”Ÿç”¢èˆ‡æ¶ˆè²»åˆ†é›¢ï¼šå¯ä»¥æå‰å•Ÿå‹•ä¸‹è¼‰ï¼Œæ¶ˆè²»è€…éš¨æ™‚åŠ å…¥ç²å–ç•¶å‰æˆ–æ­·å²é€²åº¦æ•¸æ“šã€‚
//ä½¿ç”¨ï¼šSharedFlow
//ç‚ºä»€éº¼ï¼Ÿ
//é€²åº¦æ•¸æ“šå¯ä»¥ç·©å­˜ï¼Œå³ä½¿æ¶ˆè²»è€…åœ¨ 50% åŠ å…¥ï¼Œä»èƒ½ç²å¾—ä¹‹å‰çš„é€²åº¦æ•¸æ“šã€‚
//å¯è¨­å®šç·©è¡å€å’Œé‡æ’­æ¬¡æ•¸ï¼Œå…è¨±æ¶ˆè²»è€…ç¨å¾Œæ”¶é›†æ•¸æ“šã€‚

//ä¾‹å­ï¼šèŠå¤©å®¤å³æ™‚è¨Šæ¯ï¼ˆSharedFlowï¼‰+ ç§èŠï¼ˆFlowï¼‰
//å³æ™‚è¨Šæ¯æµï¼š å»£æ’­çµ¦æ‰€æœ‰ç”¨æˆ¶ï¼Œä½¿ç”¨ SharedFlowã€‚
//å€‹äººç§èŠè¨Šæ¯ï¼š åªæœ‰ç”¨æˆ¶é»é–‹å°è©±æ¡†å¾Œæ‰å»ºç«‹æ•¸æ“šæµï¼Œä½¿ç”¨ Flowã€‚
//è‚¡ç¥¨æ•¸æ“šæµè¨­è¨ˆæ¦‚å¿µï¼š
//
//åº•å±¤æ•¸æ“šä¾†æºï¼ˆå¾Œå°ï¼‰ï¼š ä½¿ç”¨ SharedFlow ä¸æ–·æ¥æ”¶è‚¡ç¥¨æ•¸æ“šï¼Œç¢ºä¿å³ä½¿æ²’æœ‰ UI æ¶ˆè²»è€…ï¼Œæ•¸æ“šæµä¹ŸæŒçºŒé‹è¡Œã€‚
//å‰å° UI é¡¯ç¤ºï¼ˆç•«é¢ï¼‰ï¼š åœ¨ç”¨æˆ¶é€²å…¥æˆ–éœ€è¦é¡¯ç¤ºè‚¡ç¥¨æ•¸æ“šæ™‚ï¼Œé€šé Flow æ”¶é›†å’Œé¡¯ç¤ºç•¶å‰çš„è‚¡ç¥¨æ•¸æ“šï¼Œé¿å…æµªè²»è³‡æºã€‚
//åˆ‡é»ï¼š Flow å¯ä»¥åœ¨ç”¨æˆ¶æ‰“é–‹é é¢æ™‚ collect SharedFlowï¼Œç²å–æœ€æ–°æ•¸æ“šã€‚
//val stockPriceFlow = MutableSharedFlow<Float>(
//    replay = 3,                   // ç·©å­˜æœ€è¿‘ 3 æ¢æ•¸æ“š
//    extraBufferCapacity = 5       // ç·©è¡å®¹é‡ï¼Œå…è¨±çªç™¼æ•¸æ“š
//)
//
//// æ¨¡æ“¬è‚¡ç¥¨æ•¸æ“šä¾†æº
//launch {
//    while (true) {
//        stockPriceFlow.emit(100 + Random.nextFloat() * 10)  // æ¨¡æ“¬è‚¡åƒ¹è®Šå‹•
//        delay(1000)  // æ¯ç§’æ¨é€ä¸€æ¬¡æ•¸æ“š
//    }
//}
//fun getStockPriceFlow(): Flow<Float> = flow {
//    stockPriceFlow.collect { latestPrice ->
//        emit(latestPrice)  // ç™¼é€æ•¸æ“šçµ¦ UI å±¤
//    }
//}
//
//// æ¨¡æ“¬ç”¨æˆ¶é€²å…¥è‚¡ç¥¨è©³æƒ…é é¢
//launch {
//    println("ğŸ“± é€²å…¥è‚¡ç¥¨é é¢ï¼Œé–‹å§‹æ¥æ”¶æ•¸æ“š...")
//    getStockPriceFlow().collect { price ->
//        println("ğŸ“ˆ ç•«é¢é¡¯ç¤ºè‚¡åƒ¹: $price")
//    }
//}
//è‚¡ç¥¨æ•¸æ“šæµï¼ˆå¾Œå°æŒçºŒé‹è¡Œï¼‰	SharedFlow	æŒçºŒç”¢ç”Ÿæ•¸æ“šï¼Œå³ä½¿ç„¡æ¶ˆè²»è€…ä¹Ÿä¸åœæ­¢
//è‚¡ç¥¨è©³æƒ…é é¢ï¼ˆå³æ™‚ä½†ä¸æŒçºŒæ”¶é›†ï¼‰	Flow + first()	åªé—œå¿ƒç•¶å‰æœ€æ–°æ•¸æ“šï¼Œé€²å…¥é é¢æ™‚æ”¶é›†ä¸€æ¬¡
//è‚¡ç¥¨èµ°å‹¢åœ–ï¼ˆæŒçºŒé¡¯ç¤ºæœ€æ–°æ•¸æ“šï¼‰	Flow + collect	é€²å…¥é é¢å¾Œé–‹å§‹æŒçºŒæ”¶é›†
//è‚¡ç¥¨è­¦å ±ï¼ˆåªé¡¯ç¤ºæœ€æ–°ç‹€æ…‹ï¼‰	StateFlow	åªéœ€è¦é—œå¿ƒæœ€æ–°è­¦å ±ï¼Œä¸è¨˜éŒ„æ­·å²æ•¸æ“š
//é›¢é–‹å¾Œåœæ­¢æ”¶é›†ï¼Œä¸å½±éŸ¿ä¸Šæ¸¸ï¼š
//é€é é—œé–‰ CoroutineScope æˆ–å–æ¶ˆ Jobï¼Œåœæ­¢ä¸‹æ¸¸æ”¶é›†ã€‚
//ä¸Šæ¸¸æŒçºŒç™¼é€æ•¸æ“šï¼Œä¸å—ä¸‹æ¸¸æ˜¯å¦å­˜åœ¨å½±éŸ¿ã€‚
//ä¸éœ€é—œé–‰ä¸Šæ¸¸ SharedFlowï¼Œä¸Šæ¸¸ä¾ç„¶åœ¨ç™¼é€æ•¸æ“šï¼š
//ä¸‹æ¸¸é›¢å ´ï¼ˆé—œé–‰é é¢ï¼‰å¾Œï¼Œä¸éœ€è¦ç‰¹æ„é—œé–‰ SharedFlowï¼ŒæŒçºŒæ•¸æ“šç”Ÿç”¢ï¼Œè®“ä¸‹ä¸€å€‹é€²ä¾†çš„æ¶ˆè²»è€…ç¹¼çºŒæ”¶é›†æ•¸æ“šã€‚
//SharedFlow æœ¬èº«ä¸æœƒå› ç‚ºä¸‹æ¸¸çš„æ¶ˆè²»è€…ï¼ˆcollectï¼‰åœæ­¢è€Œä¸­æ–·ï¼Œå› ç‚ºå®ƒæ˜¯ç†±æµï¼ˆHot Flowï¼‰ï¼Œç”Ÿç”¢è€…æœƒä¸€ç›´æŒçºŒç™¼é€æ•¸æ“šï¼Œèˆ‡æ¶ˆè²»è€…çš„ç”Ÿå‘½å‘¨æœŸè§£è€¦ã€‚